#!/bin/zsh

echo "‚ö†Ô∏è Warning, this is a destructive script and will overwrite your current dotfiles, intended for new machines."
echo "This will install xcode tools and close a private repo afterwards."
echo "If you don't have a github token, you can't continue."

echo "--------------------------------"
echo "Are you sure you want to continue? (y/n)"
read -s CONTINUE
if [ "$CONTINUE" != "y" ]; then
    echo "Exiting..."
    exit 1
fi

# install xcode tools
echo "üì¶ Installing Xcode tools..."
xcode-select --install
echo "‚úÖ Xcode tools installed"

# fix git config
echo "üîí Fixing git config..."
# ask for git name
echo -n "Enter your Git name: "
read -s GIT_NAME
if [ -z "$GIT_NAME" ]; then
    echo "‚ùå Error: Git name is required"
    exit 1
fi
# ask for git email
echo -n "Enter your Git email: "
read -s GIT_EMAIL
if [ -z "$GIT_EMAIL" ]; then
    echo "‚ùå Error: Git email is required"
    exit 1
fi
git config --global user.name "$GIT_NAME"
git config --global user.email "$GIT_EMAIL"
echo "‚úÖ Git config fixed"

# ask for github token
echo "üìù Asking for GitHub token, find your token here: https://github.com/settings/tokens"
echo -n "Enter your GitHub token: "
read -s TOKEN
if [ -z "$TOKEN" ]; then
    echo "‚ùå Error: GitHub token is required"
    exit 1
fi
echo "‚úÖ GitHub token entered"

# clone the repository
echo "üì• Cloning the private osx-dotfiles repository..."
git clone https://"$TOKEN"@github.com/TroTi13/osx-dotfiles.git ~/dotfiles
echo "‚úÖ Private osx-dotfiles repository cloned"

unset TOKEN

# run the init script
echo "üöÄ Running the init script..."
~/dotfiles/init.sh
echo "‚úÖ Init script completed"

# cleanup
echo "üßπ Do you want to cleanup the private repository? (y/n)"
read -s CLEANUP
if [ "$CLEANUP" = "y" ]; then
    echo "üßπ Cleaning up the private repository..."
    rm -rf ~/dotfiles
    echo "‚úÖ Private repository cleaned up"
fi

echo "‚úÖ All done!"